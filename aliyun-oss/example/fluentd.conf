<match debug.*>
  @type oss
  endpoint "#{ENV['OSS_ENDPOINT']}"
  bucket "#{ENV['OSS_BUCKET']}"
  access_key_id "#{ENV['OSS_ACCESS_KEY_ID']}"
  access_key_secret "#{ENV['OSS_ACCESS_KEY_SECRET']}"
  path k8s/logs
  auto_create_bucket false
  time_slice_format %Y%m%d%H
  key_format %{path}/%{time_slice}_%{index}_%{thread_id}.%{file_extension}
  store_as gzip
  <buffer tag,time>
    @type file
    path /var/log/fluent/oss
    timekey 3600 # 1h partition
    timekey_wait 1m # wait 1m and upload
    timekey_use_utc true
  </buffer>
  <format>
    @type json
  </format>
</match>

# <match debug.*>
#   @type stdout
# </match>

# HTTP input
# POST http://localhost:8888/<tag>?json=<json>
# POST http://localhost:8888/td.myapp.login?json={"user"%3A"me"}
# @see http://docs.fluentd.org/articles/in_http
<source>
  @type http
  @id input_http
  port 8888
</source>
